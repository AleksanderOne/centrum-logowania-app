name: ðŸš€ Generowanie Wersji

on:
  push:
    branches:
      - main

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  generowanie-wersji:
    name: ðŸ“¦ Generowanie Wersji Aplikacji
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Pobieranie Kodu
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: false

      - name: âš™ï¸ Konfiguracja Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 'lts/*'
          cache: 'npm'

      - name: ðŸ“š Instalacja ZaleÅ¼noÅ›ci
        run: npm ci

      - name: ðŸ·ï¸ Generowanie Wersji i Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          HUSKY: '0'
        run: |
          # Pobierz obecnÄ… wersjÄ™ przed uruchomieniem release
          OLD_VERSION=$(npm pkg get version | tr -d '"')
          echo "ðŸ“… Poprzednia wersja: $OLD_VERSION"

          echo "ðŸš€ Rozpoczynam generowanie nowej wersji..."
          npx semantic-release

          # Pobierz nowÄ… wersjÄ™ po zakoÅ„czeniu
          NEW_VERSION=$(npm pkg get version | tr -d '"')
          echo "âœ… Proces semantic-release zakoÅ„czony!"

          # WyÅ›wietl wyraÅºnÄ… informacjÄ™ o zmianie wersji
          if [ "$OLD_VERSION" != "$NEW_VERSION" ]; then
            echo "========================================================"
            echo "             ðŸš€ WERSJA PODBITA POMYÅšLNIE ðŸš€             "
            echo "========================================================"
            echo "   ðŸ“‰ STARA WERSJA: $OLD_VERSION"
            echo "   ðŸ“ˆ NOWA WERSJA:  $NEW_VERSION"
            echo "========================================================"
            echo "::notice title=Aktualizacja Wersji::Aplikacja zaktualizowana z wersji $OLD_VERSION na $NEW_VERSION"
            
            # Podsumowanie widoczne na gÅ‚Ã³wnej stronie uruchomienia (bez wchodzenia w logi)
            echo "# ðŸš€ Wersja Podbita PomyÅ›lnie" >> $GITHUB_STEP_SUMMARY
            echo "## ðŸ“‰ $OLD_VERSION âž¡ï¸ ðŸ“ˆ **$NEW_VERSION**" >> $GITHUB_STEP_SUMMARY
            echo "**Data:** $(date)" >> $GITHUB_STEP_SUMMARY
          else
            echo "â„¹ï¸ Brak zmian kwalifikujÄ…cych siÄ™ do nowej wersji."
            echo "### â„¹ï¸ Brak zmian w wersji ($OLD_VERSION)" >> $GITHUB_STEP_SUMMARY
          fi
